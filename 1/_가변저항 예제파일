#include <LiquidCrystal.h> // initialize the library with the numbers of the interface pinsLiquidCrystal lcd(12, 11, 5, 4, 3, 2);const int modePin = 8;       //"모드(전환)버튼"을 연결한 핀const int upPin = 9;           //"업버튼"을 연결한 핀const int downPin = 10;     //"다운버튼"을 연결한 핀const int tonePin = 7;        //알람을 위한 부저를 연결한 핀float Tvoltage = 3.4;         //큰 의미 없으나... 초기 임계전압값void setup() {  pinMode(modePin, INPUT_PULLUP);  // modePin 핀(8번)에 해당하는 아두이노 내부의 풀업저항 활성화  pinMode(upPin, INPUT_PULLUP);      // upPin핀에 해당하는 아두이노 내부의 풀업저항 활성화  pinMode(downPin, INPUT_PULLUP);   // downPin핀 해당하는 아두이노 내부의 풀업저항 활성화  pinMode(tonePin, OUTPUT);             // 알람을 위한 부저를 연결한 핀    Serial.begin(9600);  lcd.begin(16, 2);    lcd.setCursor(2, 0);  lcd.print("V-Controller");    lcd.setCursor(0, 1);  lcd.print("V:");}void setupVoltage() {  int mode = HIGH;  int Count = 0;  int preDownButtonState = HIGH;  int preUpButtonState = HIGH;  int downButtonState, upButtonState;    lcd.clear();  lcd.setCursor(4, 0);  lcd.print("Setup");  lcd.setCursor(0, 1);  lcd.print(Tvoltage);  delay(100);  while(mode) {    //"모드 버튼이  눌리지 않았다면 digitalRead(modePin) 함수가 리턴하는 값은(pullup 구조라서) HIGH!    mode = digitalRead(modePin);   // 모드버튼이 눌렸다면 변수 mode에는 LOW 값이 할당됨.    upButtonState = digitalRead(upPin);    downButtonState = digitalRead(downPin);        // 9번 핀에 연결된 업버튼이 눌렸다면 현재 9번 핀의 상태는 LOW,     // 따라서 과거에는 HIGH이고 현재 LOW라면 버튼이 막 눌렸다고 판단함.    if ( preUpButtonState == HIGH && upButtonState == LOW ) {       Tvoltage += 0.1;      if (Tvoltage > 5.0) {    // 무턱대고 임계 전압값을 올릴 경우 최대 5[V]로 고정.        Tvoltage = 5.0;      }    }    if ( preDownButtonState == HIGH && downButtonState == LOW ) {      Tvoltage -= 0.1;      if( Tvoltage < 0 ) {        Tvoltage = 0.0;      }     }    preUpButtonState = upButtonState;                     // 현 버튼 상태 값을 (과거 상태로) 백업    preDownButtonState = downButtonState;             //  다음에 버튼 상태를 다시 읽을 때 지금은 과거가 됨.        lcd.setCursor(0, 1);    lcd.print(Tvoltage);  }}void loop() {  float voltage = analogRead(A0) * 5.0/1023.0;  int mode = digitalRead(modePin);  // 모드 전환 스위치가 눌렸는지 파악하기 위해  if (mode == 0) {                        // 모드 전환 스위치가 눌렸다면    setupVoltage();                        // 임계 전압값 변경 처리     lcd.setCursor(2, 0);                // 임계 전압값 변경 처리를 마친 후 원 화면 복원     lcd.print("V-Controller");     lcd.setCursor(0, 1);     lcd.print("V:");  }  lcd.setCursor(2, 1);                      lcd.print(voltage);  lcd.setCursor(6, 1);  lcd.print("[V]");  delay(200);    if (voltage > Tvoltage) {                   // 입력 전압이 입계전압값을 초과 했을 때    tone(tonePin, 1000);                     // 알람 신호 발생 & LCD 화면 껌벅임.    lcd.noDisplay();                           delay(200);    lcd.display();    noTone(tonePin);  }}
